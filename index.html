<!DOCTYPE html>
<html lang="fa" dir="rtl">

<head>
  <meta charset="UTF-8">
  <title>5-Day Weather Forecast</title>
  <style>
    /* Your CSS styles from the original code */
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #f0f4f8;
      color: #333;
    }

    .weather-card {
      background-color: #ffffff;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 15px;
      margin: 10px 0;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
    }

    .back-button {
      margin-top: 20px;
      padding: 10px 20px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-family: Arial, sans-serif;
      font-size: 16px;
    }

    .back-button:hover {
      background-color: #0056b3;
    }
  </style>
</head>

<body>

  <h1>5-Day Weather Forecast</h1>
  <label for="city-input">Enter city:</label>
  <input type="text" id="city-input" placeholder="e.g., Tehran">
  <button onclick="updateWeather()">Get Forecast</button>

  <div id="weather-container"></div>
  <button class="back-button" onclick="window.location.reload()">بازگشت به منو</button>

  <script>
    const API_KEY = '2a98a59b571a3309e5e2e8f5658d09ce';
    const CITY = 'Tehran';

    async function getWeatherData(city) {
      try {
        // Get coordinates for the city
        const geoResponse = await fetch(
          `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${API_KEY}&units=metric`
        );
        if (!geoResponse.ok) throw new Error('Geolocation request failed');

        const geoData = await geoResponse.json();
        const { lat, lon } = geoData.coord;

        // Get 5-day forecast
        const forecastResponse = await fetch(
          `https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric`
        );
        if (!forecastResponse.ok) throw new Error('Forecast request failed');

        return forecastResponse.json();
      } catch (error) {
        console.error('Error fetching weather data:', error);
        return null;
      }
    }

    function displayWeather(forecastData) {
      const weatherContainer = document.getElementById('weather-container');
      weatherContainer.innerHTML = ''; // Clear existing content

      if (!forecastData || !forecastData.list) {
        weatherContainer.innerHTML = '<p>Unable to load weather data. Please try again later.</p>';
        return;
      }

      // Group by date and create daily forecasts
      const dailyForecasts = {};
      forecastData.list.forEach(item => {
        const date = new Date(item.dt * 1000).toISOString().split('T')[0]; // "YYYY-MM-DD"
        if (!dailyForecasts[date]) {
          dailyForecasts[date] = {
            date,
            description: item.weather[0].description,
            tempMin: parseFloat(item.main.temp_min).toFixed(1),
            tempMax: parseFloat(item.main.temp_max).toFixed(1),
            icon: item.weather[0].icon,
            humidity: item.main.humidity
          };
        }
      });

      // Sort forecasts by date
      const sortedDates = Object.keys(dailyForecasts).sort();
      sortedDates.forEach(date => {
        const forecast = dailyForecasts[date];
        const card = document.createElement('div');
        card.className = 'weather-card';
        card.innerHTML = `
        <h3>${forecast.date}</h3>
        <p> وضعیت هوا: ${forecast.description} </p>
        <p> حداقل دما: ${forecast.tempMin}°C </p>
        <p> حداکثر دما: ${forecast.tempMax}°C </p>
        <p> رطوبت: ${forecast.humidity}% </p>
      `;
        weatherContainer.appendChild(card);
      });
    }

    // Update JavaScript to use the input value
    async function updateWeather() {
      const city = document.getElementById('city-input').value || 'Tehran';
      const forecastData = await getWeatherData(city);
      displayWeather(forecastData);
    }

    // async function init() {
    //   const forecastData = await getWeatherData(CITY);
    //   displayWeather(forecastData);
    // }

    // Initialize application
    // init();
    updateWeather();
  </script>

</body>

</html>